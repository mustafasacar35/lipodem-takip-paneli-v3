<!DOCTYPE html>
<html>
<head>
    <title>Hedef-Bazlı Algoritma Test</title>
</head>
<body>
    <h1>Test: Hedef-Bazlı Alternatif Algoritması</h1>
    
    <div id="results"></div>
    
    <script>
        // Test senaryoları
        const testScenarios = [
            {
                name: "Senaryo 1: %20 Eksik Durum",
                weeklyTargetGap: {
                    targetKcal: 2000,
                    actualKcal: 1600,
                    gapPercent: -20, // Eksik
                    description: "%20 EKSİK"
                },
                currentFood: { name: "Köfte", calories: 300 },
                candidates: [
                    { name: "Pizza", calories: 500 },
                    { name: "Salata", calories: 150 },
                    { name: "İdeal Yemek", calories: 360 }, // 300 * 1.2
                ]
            },
            {
                name: "Senaryo 2: %15 Fazla Durum", 
                weeklyTargetGap: {
                    targetKcal: 2000,
                    actualKcal: 2300,
                    gapPercent: 15, // Fazla
                    description: "%15 FAZLA"
                },
                currentFood: { name: "Hamburger", calories: 400 },
                candidates: [
                    { name: "Tavuk Salatası", calories: 200 },
                    { name: "Steik", calories: 600 },
                    { name: "İdeal Yemek", calories: 340 }, // 400 * 0.85
                ]
            }
        ];

        function calculateTargetBasedScore(currentFood, candidate, weeklyTargetGap) {
            try {
                const currentCalories = currentFood.calories || 0;
                const candidateCalories = candidate.calories || 0;
                
                const gapPercent = weeklyTargetGap.gapPercent;
                
                // İdeal kalori hesapla
                const idealCalories = currentCalories * (1 - (gapPercent / 100));
                
                // İdeal kaloriye ne kadar yakın?
                const idealDistance = Math.abs(candidateCalories - idealCalories);
                const referenceCalorie = Math.max(currentCalories, idealCalories);
                const normalizedDistance = idealDistance / referenceCalorie;
                
                // Skor: 0-100 arası
                const proximityScore = Math.max(0, 100 - (normalizedDistance * 100));
                
                // Doğru yön bonusu
                let directionBonus = 0;
                const isMovingCorrectDirection = 
                    (gapPercent > 0 && candidateCalories < currentCalories) || 
                    (gapPercent < 0 && candidateCalories > currentCalories);
                
                if (isMovingCorrectDirection) {
                    directionBonus = 15;
                }
                
                const finalScore = Math.min(100, proximityScore + directionBonus);
                
                return {
                    idealCalories,
                    idealDistance,
                    proximityScore,
                    directionBonus,
                    finalScore
                };
            } catch (e) {
                return { error: e.message };
            }
        }

        // Test çalıştır
        function runTests() {
            let html = '<table border="1" style="border-collapse: collapse; width: 100%;">';
            html += '<tr><th>Senaryo</th><th>Yemek</th><th>Kalori</th><th>İdeal Kalori</th><th>Skor</th><th>Detay</th></tr>';
            
            testScenarios.forEach(scenario => {
                html += `<tr><td colspan="6" style="background: #f0f0f0; font-weight: bold;">${scenario.name} (${scenario.weeklyTargetGap.description})</td></tr>`;
                html += `<tr><td colspan="6">Orijinal: ${scenario.currentFood.name} (${scenario.currentFood.calories} kcal)</td></tr>`;
                
                scenario.candidates.forEach(candidate => {
                    const result = calculateTargetBasedScore(scenario.currentFood, candidate, scenario.weeklyTargetGap);
                    
                    html += '<tr>';
                    html += `<td>Alternatif</td>`;
                    html += `<td>${candidate.name}</td>`;
                    html += `<td>${candidate.calories}</td>`;
                    html += `<td>${result.idealCalories?.toFixed(0) || 'N/A'}</td>`;
                    html += `<td>${result.finalScore?.toFixed(1) || 'ERROR'}</td>`;
                    html += `<td>Mesafe: ${result.idealDistance?.toFixed(0)}, Bonus: ${result.directionBonus}</td>`;
                    html += '</tr>';
                });
            });
            
            html += '</table>';
            document.getElementById('results').innerHTML = html;
        }

        // Sayfa yüklendiğinde test et
        runTests();
    </script>
</body>
</html>
